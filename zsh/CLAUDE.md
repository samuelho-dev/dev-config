# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with Zsh configuration in this directory.

## Architecture Overview

Three-file Zsh configuration using Oh My Zsh framework with Powerlevel10k theme.

## File Structure

```
zsh/
├── .zshrc            # Main shell configuration (132 lines)
├── .zprofile         # Login shell PATH setup (20 lines)
└── .p10k.zsh         # Powerlevel10k theme config (1739 lines, generated)
```

**Symlink locations:**
- `~/.zshrc` → `zsh/.zshrc`
- `~/.zprofile` → `zsh/.zprofile`
- `~/.p10k.zsh` → `zsh/.p10k.zsh`

**Machine-specific:** `~/.zshrc.local` (gitignored, created by install.sh)

## File Responsibilities

### .zshrc - Main Configuration

**Purpose:** Interactive shell configuration

**Key sections:**

#### 1. Powerlevel10k Instant Prompt (lines 1-6)
```zsh
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi
```

**Critical:** Must be at the top! Enables instant prompt for fast shell startup.

**Don't add anything before this block** that requires console input or produces output.

#### 2. Oh My Zsh Setup (lines 8-82)
- `ZSH` variable: Points to `~/.oh-my-zsh`
- `ZSH_THEME`: Set to `powerlevel10k/powerlevel10k`
- Plugins: `git zsh-autosuggestions` (line 80)
- Source Oh My Zsh: `source $ZSH/oh-my-zsh.sh` (line 82)

#### 3. User Configuration (lines 84-93)
- `EDITOR='nvim'` and `VISUAL='nvim'` (lines 92-93)
- Git commits, crontab, etc. use Neovim

#### 4. PATH Additions (lines 113-136)
**Platform-agnostic with existence checks:**

```zsh
# Local bin (if exists)
[ -d "$HOME/.local/bin" ] && export PATH="$HOME/.local/bin:$PATH"

# bun (if installed)
if [ -d "$HOME/.bun" ]; then
  export BUN_INSTALL="$HOME/.bun"
  [ -d "$BUN_INSTALL/bin" ] && export PATH="$BUN_INSTALL/bin:$PATH"
  [ -s "$BUN_INSTALL/_bun" ] && source "$BUN_INSTALL/_bun"
fi

# pnpm (if installed)
if [ -d "$HOME/Library/pnpm" ]; then
  export PNPM_HOME="$HOME/Library/pnpm"
  case ":$PATH:" in
    *":$PNPM_HOME:"*) ;;
    *) export PATH="$PNPM_HOME:$PATH" ;;
  esac
fi
```

**Key principle:** Always check directory exists before adding to PATH or sourcing.

#### 5. Aliases (line 133)
```zsh
alias claude-work='CLAUDE_CONFIG_DIR=~/.claude_work claude'
```

#### 6. Machine-Specific Config (line 136)
```zsh
[ -f "$HOME/.zshrc.local" ] && source "$HOME/.zshrc.local"
```

Sources `.zshrc.local` if it exists (created by install.sh, gitignored).

### .zprofile - Login Shell PATH

**Purpose:** Set PATH for login shells (runs before .zshrc)

**Key sections:**

#### 1. Python Paths (lines 1-9, platform-specific)
```zsh
if [ -d "/Library/Frameworks/Python.framework/Versions/3.13/bin" ]; then
  PATH="/Library/Frameworks/Python.framework/Versions/3.13/bin:${PATH}"
fi

if [ -d "/Library/Frameworks/Python.framework/Versions/3.11/bin" ]; then
  PATH="/Library/Frameworks/Python.framework/Versions/3.11/bin:${PATH}"
fi

export PATH
```

**Order matters:** 3.13 before 3.11 (takes precedence).

**Existence check:** Only adds if directory exists.

#### 2. Homebrew Setup (lines 12-20, multi-platform)
```zsh
if [ -f /opt/homebrew/bin/brew ]; then
  eval "$(/opt/homebrew/bin/brew shellenv)"           # macOS Apple Silicon
elif [ -f /usr/local/bin/brew ]; then
  eval "$(/usr/local/bin/brew shellenv)"              # macOS Intel
elif [ -f /home/linuxbrew/.linuxbrew/bin/brew ]; then
  eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"  # Linux
fi
```

**Detects all Homebrew locations** - works on any platform.

### .p10k.zsh - Powerlevel10k Theme

**Purpose:** Powerlevel10k theme configuration (1739 lines, auto-generated)

**Generated by:** `p10k configure`

**Customization approach:** Don't edit manually! Use `p10k configure` interactive wizard.

**Reconfigure theme:**
```bash
p10k configure
```

**Sections:**
- Prompt elements (git, time, directory, etc.)
- Colors and styles
- Segment configuration
- Transient prompt settings
- Character set (Unicode vs ASCII)

## Oh My Zsh Integration

### Framework Location

**Installed to:** `~/.oh-my-zsh/` (by install.sh)

**Structure:**
```
~/.oh-my-zsh/
├── oh-my-zsh.sh              # Main framework
├── themes/                   # Built-in themes
├── plugins/                  # Built-in plugins
└── custom/
    ├── themes/
    │   └── powerlevel10k/    # Custom theme (installed by install.sh)
    └── plugins/
        └── zsh-autosuggestions/  # Custom plugin (installed by install.sh)
```

### Plugins

**Configured in .zshrc line 80:**
```zsh
plugins=(git zsh-autosuggestions)
```

#### git plugin (built-in)
Provides aliases:
- `g` = `git`
- `ga` = `git add`
- `gc` = `git commit`
- `gst` = `git status`
- `gp` = `git push`
- `gl` = `git pull`
- Many more! See: https://github.com/ohmyzsh/ohmyzsh/tree/master/plugins/git

#### zsh-autosuggestions (custom)
**Location:** `~/.oh-my-zsh/custom/plugins/zsh-autosuggestions`

**Installed by:** `install.sh`

**Behavior:**
- Suggests commands from history as you type (gray text)
- Press `→` (right arrow) to accept suggestion
- Press `Ctrl+→` to accept one word

**Customization:**
```zsh
# Change suggestion color
ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE='fg=8'

# Change strategy (history, completion, match_prev_cmd)
ZSH_AUTOSUGGEST_STRATEGY=(history completion)
```

Add to `.zshrc` before `source $ZSH/oh-my-zsh.sh`.

### Adding Plugins

**Built-in plugins:**
1. Find plugin: `ls ~/.oh-my-zsh/plugins/`
2. Add to .zshrc line 80:
   ```zsh
   plugins=(git zsh-autosuggestions docker npm)
   ```
3. Reload: `source ~/.zshrc`

**Custom plugins:**
1. Clone to `~/.oh-my-zsh/custom/plugins/`:
   ```bash
   git clone https://github.com/author/plugin ~/.oh-my-zsh/custom/plugins/plugin
   ```
2. Add to .zshrc:
   ```zsh
   plugins=(git zsh-autosuggestions plugin)
   ```
3. Reload: `source ~/.zshrc`

## Machine-Specific Configuration

### .zshrc.local Pattern

**Purpose:** Separate machine-specific config from shared config.

**Location:** `~/.zshrc.local` (in home directory, NOT in repo)

**Gitignored:** Yes (`.gitignore` line 23)

**Created by:** `install.sh` with template

**Template content:**
```zsh
# .zshrc.local - Machine-specific zsh configuration
# This file is sourced by .zshrc and is gitignored
# Add your machine-specific PATH additions, aliases, and environment variables here

# Example: Add custom bin directory to PATH
# export PATH="$HOME/bin:$PATH"

# Example: Machine-specific aliases
# alias work-vpn="sudo openvpn /path/to/config.ovpn"

# Example: Environment variables for local development
# export DATABASE_URL="postgresql://localhost:5432/mydb"
```

**Usage:**
```zsh
# Edit with:
nvim ~/.zshrc.local

# Add machine-specific config:
export PATH="$HOME/custom-tools:$PATH"
alias work-server="ssh user@work.example.com"
export API_KEY="secret-key-here"

# Reload:
source ~/.zshrc
```

**Benefits:**
- ✅ Secrets stay out of Git
- ✅ Machine-specific PATH without polluting shared config
- ✅ Different config on work vs personal machines
- ✅ Survives updates to .zshrc

## PATH Management Best Practices

### Order of Execution

1. `.zprofile` (login shell)
   - Sets Python paths
   - Sets up Homebrew
2. `.zshrc` (interactive shell)
   - Loads Oh My Zsh
   - Adds bun, pnpm, .local/bin
   - Sources .zshrc.local
3. `.zshrc.local` (machine-specific)
   - Custom PATH additions
   - Machine-specific settings

**Result:** Later additions take precedence (prepended to PATH).

### Adding to PATH

**Preferred pattern:**
```zsh
# Check existence before adding
[ -d "$HOME/new-tool/bin" ] && export PATH="$HOME/new-tool/bin:$PATH"

# Or with if statement for more complex logic
if [ -d "$HOME/new-tool" ]; then
  export PATH="$HOME/new-tool/bin:$PATH"
  export NEW_TOOL_HOME="$HOME/new-tool"
fi
```

**Add to:**
- `.zprofile` - For fundamental system paths
- `.zshrc` - For development tools
- `.zshrc.local` - For machine-specific tools

### Debugging PATH

```bash
# View entire PATH
echo $PATH

# View PATH as list
echo $PATH | tr ':' '\n'

# Check where command is found
which command-name

# Check all instances in PATH
whence -a command-name
```

## Customization Examples

### Aliases

**Add to .zshrc or .zshrc.local:**
```zsh
# Navigation
alias ..='cd ..'
alias ...='cd ../..'
alias ~='cd ~'

# ls shortcuts
alias ll='ls -lah'
alias la='ls -A'
alias l='ls -CF'

# Git shortcuts (in addition to Oh My Zsh git plugin)
alias glog='git log --oneline --graph --all'
alias guncommit='git reset --soft HEAD~1'

# Project shortcuts
alias proj='cd ~/Projects'
alias dotfiles='cd ~/Projects/dev-config'

# Safety
alias rm='rm -i'
alias cp='cp -i'
alias mv='mv -i'
```

### Functions

**Add to .zshrc or .zshrc.local:**
```zsh
# Create directory and cd into it
mkcd() {
  mkdir -p "$1" && cd "$1"
}

# Extract any archive
extract() {
  if [ -f $1 ] ; then
    case $1 in
      *.tar.bz2)   tar xjf $1     ;;
      *.tar.gz)    tar xzf $1     ;;
      *.bz2)       bunzip2 $1     ;;
      *.rar)       unrar e $1     ;;
      *.gz)        gunzip $1      ;;
      *.tar)       tar xf $1      ;;
      *.tbz2)      tar xjf $1     ;;
      *.tgz)       tar xzf $1     ;;
      *.zip)       unzip $1       ;;
      *.Z)         uncompress $1  ;;
      *.7z)        7z x $1        ;;
      *)     echo "'$1' cannot be extracted via extract()" ;;
    esac
  else
    echo "'$1' is not a valid file"
  fi
}

# Git commit with current timestamp
gctt() {
  git commit -m "$1 - $(date +%Y-%m-%d\ %H:%M:%S)"
}
```

### Environment Variables

**Add to .zshrc or .zshrc.local:**
```zsh
# Language-specific
export GOPATH="$HOME/go"
export PATH="$GOPATH/bin:$PATH"

export RUST_SRC_PATH="$(rustc --print sysroot)/lib/rustlib/src/rust/src"

# Development
export DATABASE_URL="postgresql://localhost:5432/dev"
export API_BASE_URL="http://localhost:3000"

# Editor
export VISUAL='nvim'
export EDITOR='nvim'
```

## Reload Configuration

```bash
# Method 1: Source .zshrc
source ~/.zshrc

# Method 2: Restart shell
exec zsh

# Method 3: Close and reopen terminal
```

**Note:** `.zprofile` only loads on login shells. To test changes, restart terminal completely.

## Troubleshooting

### PATH not updated

1. Check file exists: `ls -la ~/.zprofile`
2. Check symlink: `readlink ~/.zprofile` (should point to dev-config)
3. Restart terminal (not just `source ~/.zshrc`)
4. Debug: `echo $PATH | tr ':' '\n'`

### Oh My Zsh not loading

1. Check installed: `ls ~/.oh-my-zsh`
2. Check ZSH variable: `echo $ZSH`
3. Check sourced: `grep "source $ZSH" ~/.zshrc`
4. Reinstall: `sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"`

### Powerlevel10k not working

1. Check theme installed: `ls ~/.oh-my-zsh/custom/themes/powerlevel10k`
2. Check ZSH_THEME: `grep ZSH_THEME ~/.zshrc`
3. Reconfigure: `p10k configure`

### zsh-autosuggestions not showing

1. Check installed: `ls ~/.oh-my-zsh/custom/plugins/zsh-autosuggestions`
2. Check plugins list: `grep "plugins=" ~/.zshrc`
3. Check terminal colors (suggestions are gray)

### .zshrc.local not sourced

1. Check exists: `ls ~/.zshrc.local`
2. Check sourcing line exists: `grep "zshrc.local" ~/.zshrc`
3. Check syntax: `zsh -n ~/.zshrc.local`

## Best Practices

1. **Keep .zshrc clean** - Use .zshrc.local for machine-specific config
2. **Always check existence** - Before adding PATH or sourcing files
3. **Order matters** - Later PATH additions take precedence
4. **Test changes** - Source .zshrc after edits
5. **Commit .zshrc changes** - But never commit .zshrc.local
6. **Use functions** - For complex logic instead of long aliases
7. **Document aliases** - Add comments for non-obvious shortcuts

## Resources

- Oh My Zsh: https://github.com/ohmyzsh/ohmyzsh
- Powerlevel10k: https://github.com/romkatv/powerlevel10k
- zsh-autosuggestions: https://github.com/zsh-users/zsh-autosuggestions
- Oh My Zsh plugins: https://github.com/ohmyzsh/ohmyzsh/tree/master/plugins
