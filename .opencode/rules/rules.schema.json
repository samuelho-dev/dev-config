{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://dev-config.local/rules.schema.json",
  "title": "Effect TS Monorepo Rules",
  "description": "Configuration schema for Effect TS library dependency rules and GritQL pattern enforcement",
  "type": "object",
  "required": ["version", "libraryTypes", "dependencyMatrix", "enforcementPolicy"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Semantic version of the rules configuration"
    },
    "description": {
      "type": "string",
      "description": "Human-readable description of the rules"
    },
    "libraryTypes": {
      "type": "object",
      "description": "Library type definitions with Effect layer mappings",
      "additionalProperties": {
        "$ref": "#/definitions/LibraryTypeDefinition"
      }
    },
    "dependencyMatrix": {
      "type": "object",
      "description": "Dependency rules between library types",
      "additionalProperties": {
        "$ref": "#/definitions/DependencyRule"
      }
    },
    "effectPatterns": {
      "type": "object",
      "description": "Effect TS pattern usage rules",
      "additionalProperties": {
        "$ref": "#/definitions/EffectPatternRule"
      }
    },
    "enforcementPolicy": {
      "$ref": "#/definitions/EnforcementPolicy"
    },
    "gritqlPatterns": {
      "$ref": "#/definitions/GritQLPatterns"
    }
  },
  "definitions": {
    "LibraryType": {
      "type": "string",
      "enum": ["contract", "data-access", "feature", "infra", "provider"],
      "description": "Valid library type identifiers"
    },
    "EffectLayer": {
      "type": "string",
      "enum": ["Domain", "Service", "Orchestration", "Infrastructure", "Integration"],
      "description": "Effect architecture layer classification"
    },
    "LibraryTypeDefinition": {
      "type": "object",
      "required": ["description", "effectLayer", "canDependOn"],
      "properties": {
        "description": {
          "type": "string",
          "description": "Human-readable description of the library type"
        },
        "effectPattern": {
          "type": "string",
          "description": "Primary Effect patterns used in this library type"
        },
        "effectLayer": {
          "$ref": "#/definitions/EffectLayer"
        },
        "canDependOn": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/LibraryType"
          },
          "description": "Library types this type can import from"
        },
        "requiredPatterns": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "GritQL patterns that must pass for this library type"
        },
        "flags": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "MLG CLI flags applicable to this library type"
        }
      }
    },
    "DependencyRule": {
      "type": "object",
      "required": ["allowedImports", "forbiddenImports", "reason"],
      "properties": {
        "allowedImports": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/LibraryType"
          },
          "description": "Library types that can be imported"
        },
        "forbiddenImports": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/LibraryType"
          },
          "description": "Library types that must not be imported"
        },
        "reason": {
          "type": "string",
          "description": "Explanation of the dependency rule"
        }
      }
    },
    "EffectPatternRule": {
      "type": "object",
      "required": ["pattern", "allowedIn", "description"],
      "properties": {
        "pattern": {
          "type": "string",
          "description": "Regex or literal pattern to match Effect usage"
        },
        "allowedIn": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/LibraryType"
          },
          "description": "Library types where this pattern is allowed"
        },
        "description": {
          "type": "string",
          "description": "Human-readable description of the pattern"
        }
      }
    },
    "EnforcementPolicy": {
      "type": "object",
      "required": ["gritqlRequired", "mlgWorkflowRequired"],
      "properties": {
        "gritqlRequired": {
          "type": "boolean",
          "description": "Require GritQL tool for code search/modification"
        },
        "mlgWorkflowRequired": {
          "type": "boolean",
          "description": "Require MLG tool for library creation"
        },
        "patternVersionTracking": {
          "type": "boolean",
          "description": "Track pattern versions between check and apply"
        },
        "mode": {
          "type": "string",
          "enum": ["strict", "warn", "off"],
          "description": "Enforcement strictness level"
        }
      }
    },
    "GritQLPatterns": {
      "type": "object",
      "properties": {
        "existing": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Currently available GritQL patterns"
        },
        "planned": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Planned GritQL patterns for future implementation"
        }
      }
    }
  }
}
