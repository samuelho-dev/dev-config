{
  "$schema": "https://opencode.ai/config.json",
  "model": "{env:OPENCODE_MODEL}",
  "small_model": "{env:OPENCODE_SMALL_MODEL}",
  "theme": "{env:OPENCODE_THEME}",
  "autoupdate": false,
  "instructions": [
    "AGENTS.md",
    "docs/nix/*.md",
    "modules/**/*.md"
  ],
  "tools": {
    "write": true,
    "edit": true,
    "bash": true,
    "read": true,
    "grep": true,
    "glob": true,
    "list": true,
    "patch": true,
    "webfetch": true,
    "todowrite": true,
    "todoread": true
  },
  "permission": {
    "edit": "allow",
    "bash": {
      "git push": "ask",
      "git commit": "ask",
      "rm -rf": "ask",
      "sudo": "deny",
      "*": "allow"
    },
    "webfetch": "allow",
    "doom_loop": "ask",
    "external_directory": "ask"
  },
  "provider": {
    "anthropic": {
      "models": {},
      "options": {
        "apiKey": "{env:ANTHROPIC_API_KEY}"
      }
    },
    "openai": {
      "models": {},
      "options": {
        "apiKey": "{env:OPENAI_API_KEY}"
      }
    }
  },
  "agent": {
    "build": {
      "mode": "primary",
      "model": "{env:OPENCODE_MODEL}",
      "temperature": 0.3,
      "tools": {
        "write": true,
        "edit": true,
        "bash": true,
        "read": true,
        "grep": true,
        "glob": true,
        "list": true,
        "patch": true,
        "webfetch": true,
        "todowrite": true,
        "todoread": true
      },
      "permission": {
        "edit": "allow",
        "bash": "allow",
        "webfetch": "allow"
      }
    },
    "plan": {
      "mode": "primary",
      "model": "{env:OPENCODE_SMALL_MODEL}",
      "temperature": 0.1,
      "tools": {
        "write": false,
        "edit": false,
        "bash": false,
        "read": true,
        "grep": true,
        "glob": true,
        "list": true,
        "webfetch": true,
        "todowrite": false,
        "todoread": true
      },
      "permission": {
        "edit": "ask",
        "bash": "ask",
        "webfetch": "allow"
      }
    },
    "nix-architect": {
      "description": "Specialized Nix configuration and Home Manager module development",
      "mode": "subagent",
      "model": "{env:OPENCODE_MODEL}",
      "temperature": 0.1,
      "prompt": "{file:./prompts/nix-architect.md}",
      "tools": {
        "write": true,
        "edit": true,
        "bash": true,
        "read": true,
        "grep": true,
        "glob": true,
        "list": true,
        "webfetch": true,
        "todowrite": true,
        "todoread": true
      }
    },
    "typescript-pro": {
      "description": "TypeScript expert with strict typing and Effect-TS patterns",
      "mode": "subagent",
      "model": "{env:OPENCODE_MODEL}",
      "temperature": 0.2,
      "prompt": "{file:./prompts/typescript-pro.md}",
      "tools": {
        "write": true,
        "edit": true,
        "bash": true,
        "read": true,
        "grep": true,
        "glob": true,
        "list": true,
        "webfetch": true,
        "todowrite": true,
        "todoread": true
      }
    },
    "devops-engineer": {
      "description": "DevOps and infrastructure specialist with NixOS and container expertise",
      "mode": "subagent",
      "model": "{env:OPENCODE_MODEL}",
      "temperature": 0.2,
      "prompt": "{file:./prompts/devops-engineer.md}",
      "tools": {
        "write": true,
        "edit": true,
        "bash": true,
        "read": true,
        "grep": true,
        "glob": true,
        "list": true,
        "webfetch": true,
        "todowrite": true,
        "todoread": true
      }
    },
    "code-reviewer": {
      "description": "Reviews code for best practices, security, and maintainability",
      "mode": "subagent",
      "model": "{env:OPENCODE_MODEL}",
      "temperature": 0.1,
      "prompt": "{file:./prompts/code-reviewer.md}",
      "tools": {
        "write": false,
        "edit": false,
        "bash": false,
        "read": true,
        "grep": true,
        "glob": true,
        "list": true,
        "webfetch": true,
        "todowrite": false,
        "todoread": true
      },
      "permission": {
        "edit": "deny",
        "bash": "deny",
        "webfetch": "allow"
      }
    }
  },
  "command": {
    "nix-fmt": {
      "template": "Format all Nix files in the project using nix fmt.\n!`nix fmt`\nCheck for any formatting issues and report them.",
      "description": "Format Nix files",
      "agent": "build"
    },
    "nix-check": {
      "template": "Run Nix syntax validation and build test.\n!`nix-instantiate --eval --strict '.#homeConfigurations'`\n!`home-manager build --flake . --dry-run`\nReport any errors or warnings.",
      "description": "Validate Nix configuration",
      "agent": "plan"
    },
    "biome-check": {
      "template": "Run Biome formatting and linting.\n!`biome check --write .`\nReport any issues that were fixed or any remaining problems.",
      "description": "Format and lint with Biome",
      "agent": "build"
    },
    "test-all": {
      "template": "Run all available tests and checks.\n!`nix-check`\n!`biome-check`\nProvide a comprehensive report of the results.",
      "description": "Run all project tests and checks",
      "agent": "build"
    },
    "home-switch": {
      "template": "Preview Home Manager changes and ask for confirmation.\n!`home-manager switch --flake . --dry-run --verbose`\nIf the user confirms, proceed with the actual switch.",
      "description": "Apply Home Manager configuration",
      "agent": "build",
      "permission": {
        "bash": {
          "home-manager switch": "ask"
        }
      }
    }
  },
  "mcp": {},
  "formatter": {
    "nix": {
      "command": ["nix", "fmt", "$FILE"],
      "extensions": [".nix"]
    },
    "biome": {
      "command": ["biome", "format", "--write", "$FILE"],
      "extensions": [".js", ".ts", ".jsx", ".tsx", ".json"]
    }
  },
  "keybinds": {
    "switch_agent": "tab",
    "session_child_cycle": "ctrl+x right",
    "session_child_cycle_reverse": "ctrl+x left"
  }
}
