#!/usr/bin/env bash
# Direnv configuration for dev-config
# Security: This file is version-controlled. No secrets here!

# Watch files BEFORE use flake (nix-direnv requirement)
# Note: flake.nix and flake.lock are watched automatically by nix-direnv
watch_file flake.nix
watch_file flake.lock

# Use Nix flake for development environment
use flake

# Load non-secret local overrides (gitignored, requires direnv allow)
# Use .env.local for non-secret environment variables (KEY=value format)
# This replaces the old .envrc.local pattern (which used source_env)
dotenv_if_exists .env.local

# Optional: Load AI credentials from 1Password (secure, just-in-time)
# Requires: 1Password CLI (op) installed and signed in
if command -v op &> /dev/null && op account list &> /dev/null 2>&1; then
  ANTHROPIC_API_KEY=$(op read "op://Dev/ai/ANTHROPIC_API_KEY" 2>/dev/null || true)
  export ANTHROPIC_API_KEY
  OPENAI_API_KEY=$(op read "op://Dev/ai/OPENAI_API_KEY" 2>/dev/null || true)
  export OPENAI_API_KEY
  GOOGLE_AI_API_KEY=$(op read "op://Dev/ai/GOOGLE_AI_API_KEY" 2>/dev/null || true)
  export GOOGLE_AI_API_KEY
  LITELLM_MASTER_KEY=$(op read "op://Dev/ai/LITELLM_MASTER_KEY" 2>/dev/null || true)
  export LITELLM_MASTER_KEY
fi
